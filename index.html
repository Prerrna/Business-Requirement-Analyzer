<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Business Requirement Analyzer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em;
            max-width: 700px;
        }
        textarea {
            width: 100%;
            height: 100px;
            font-size: 1em;
            padding: 0.5em;
            margin-bottom: 1em;
        }
        button {
            padding: 0.5em 1em;
            font-size: 1em;
            margin-right: 0.4em;
        }
        #output, #saved {
            margin-top: 1em;
            background: #f4f4f4;
            padding: 1em;
            border-radius: 6px;
        }
        h2 { margin-top: 2em; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 0.5em;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 0.6em;
            text-align: left;
        }
        th {
            background-color: #eee;
        }
    </style>
</head>
<body>
    <h1>Business Requirement Analyzer</h1>
    <textarea id="requirement" placeholder="Enter requirement description here..."></textarea><br />
    <button onclick="analyzeRequirement()">Analyze & Save</button>
    <button onclick="listRequirements()">Show Saved</button>
    <button onclick="clearRequirements()">Clear All</button>

    <div id="output"></div>

    <h2>Saved Requirements</h2>
    <div id="saved"></div>

    <script>
        async function analyzeRequirement() {
            const reqText = document.getElementById('requirement').value.trim();
            if (!reqText) {
                alert('Please enter a requirement description.');
                return;
            }
            const response = await fetch('/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ requirement: reqText })
            });
            const data = await response.json();
            document.getElementById('output').innerHTML =
                `<p><b>Category:</b> ${data.category}</p><p><b>Keywords:</b> ${data.keywords}</p>`;
            document.getElementById('requirement').value = '';
            listRequirements();
        }

        async function listRequirements() {
            const response = await fetch('/list');
            const data = await response.json();
            if (data.length === 0) {
                document.getElementById('saved').innerHTML = '<p>No saved requirements.</p>';
                return;
            }
            let html = `<table><thead><tr><th>ID</th><th>Description</th><th>Category</th><th>Keywords</th></tr></thead><tbody>`;
            data.forEach(item => {
                html += `<tr>
                    <td>${item.id}</td>
                    <td>${item.text}</td>
                    <td>${item.category}</td>
                    <td>${item.keywords}</td>
                </tr>`;
            });
            html += '</tbody></table>';
            document.getElementById('saved').innerHTML = html;
        }

        async function clearRequirements() {
            if (!confirm('Are you sure you want to delete all requirements?')) return;
            await fetch('/clear', { method: 'POST' });
            document.getElementById('output').innerHTML = '';
            listRequirements();
        }

        // Load saved on page load
        listRequirements();
    </script>
</body>
</html>
